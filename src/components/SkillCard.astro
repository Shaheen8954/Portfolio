---
// src/components/SkillCard.astro
import {
  Card,
  CardHeader,
  CardTitle,
  CardContent,
  CardFooter,
} from '@/components/ui/card';
import {
  MonitorSmartphone,
  ServerCog,
  Database,
  PenTool,
  Network,
  Container,
  Cloud,
  GitBranch,
  Code,
  Activity,
  Terminal,
  ShieldCheck,
  BookOpenCheck,
  type LucideIcon,
} from 'lucide-react';
import type { IconType } from 'react-icons';
// Import only the icons that are actually available
import {
  SiReact, 
  SiTypescript, 
  SiJavascript,
  SiNodedotjs,
  SiPython,
  SiDocker,
  SiKubernetes,
  SiGit,
  SiGithub,
  SiGitlab,
  SiTerraform,
  SiAnsible,
  SiPrometheus,
  SiGrafana,
  SiElastic,
  SiVault,
  SiHelm,
  SiArgo,
  SiGnubash,
  SiGo,
  SiJenkins,
  SiMongodb,
  SiPostgresql,
  SiMysql,
  SiSqlite,
  SiNestjs,
  SiExpress,
  SiPrisma,
  SiAmazonec2,
  SiAmazons3,
  SiAmazondynamodb,
  SiAmazonrds,
  SiAmazonecs,
  SiAwslambda,
  SiAmazoncloudwatch,
  SiAmazonroute53,
  SiAmazonapigateway,
  SiGithubactions,
  SiConsul,
  SiNomad,
  SiVagrant,
  SiNginx,
  SiApache,
  SiLinux,
  SiUbuntu,
  SiDebian,
  SiCentos,
  SiRedhat,
  SiServerless,
  SiDatadog,
  SiNewrelic,
  SiSentry
} from 'react-icons/si';



// AWS and Cloud Icons from react-icons/si
import { 
  SiAmazonec2 as SiEc2,
  SiAmazons3 as SiS3,
  SiAmazonrds as SiRds,
  SiAwslambda as SiLambda,
  SiAmazoncloudwatch as SiCloudWatch,
  SiAmazonroute53 as SiRoute53,
  SiAmazonapigateway as SiApiGateway,
  SiAmazonecs as SiEcs,
  SiAmazondynamodb as SiDynamoDB
} from 'react-icons/si';

// Fallback icons
const SiHcl = SiTerraform;
const SiPulumi = SiTerraform;
const SiGithubActions = SiGithub;
const SiAwsEcs = SiAmazonecs;
const SiAwsCloudwatch = SiAmazoncloudwatch;
const SiAwsRoute53 = SiAmazonroute53;
const SiAwsApigateway = SiAmazonapigateway;

// Define the mapping from iconName to Lucide icon component
const iconComponents: Record<string, LucideIcon> = {
  MonitorSmartphone,
  ServerCog,
  Database,
  PenTool,
  Network,
  Container,
  Cloud,
  GitBranch,
  Code,
  Activity,
  Terminal,
  ShieldCheck,
  BookOpenCheck,
  Windows: ServerCog, // Fallback for Windows
};

// Mapping for technology icons
const techIconComponents: Record<string, any> = {
  // Programming Languages
  react: SiReact,
  typescript: SiTypescript,
  javascript: SiJavascript,
  nodejs: SiNodedotjs,
  python: SiPython,
  go: SiGo,
  bash: SiGnubash,
  
  // Databases
  postgresql: SiPostgresql,
  mysql: SiMysql,
  mongodb: SiMongodb,
  sqlite: SiSqlite,
  dynamodb: SiDynamoDB,
  
  // Backend & ORM
  prisma: SiPrisma,
  nestjs: SiNestjs,
  express: SiExpress,
  
  // Containers & Orchestration
  docker: SiDocker,
  'docker-compose': SiDocker,
  kubernetes: SiKubernetes,
  helm: SiHelm,
  
  // Version Control & CI/CD
  git: SiGit,
  github: SiGithub,
  'github-actions': SiGithubActions || SiGithub,
  gitlab: SiGitlab,
  'gitlab-ci': SiGitlab,
  jenkins: SiJenkins,
  argocd: SiArgo,
  gitops: SiGit,
  
  // Infrastructure as Code
  terraform: SiTerraform,
  pulumi: SiPulumi,
  ansible: SiAnsible,
  
  // Monitoring & Observability
  prometheus: SiPrometheus,
  grafana: SiGrafana,
  datadog: SiDatadog,
  newrelic: SiNewrelic,
  sentry: SiSentry,
  
  // Security
  vault: SiVault,
  'hashicorp-vault': SiVault,
  

  
  // AWS Services
  ec2: SiEc2,
  s3: SiS3,
  rds: SiRds,
  lambda: SiLambda,
  route53: SiRoute53,
  apigateway: SiApiGateway,
  cloudwatch: SiCloudWatch,
  ecs: SiEcs,

  
  
  // Workflow
  gitflow: SiGit,
  'trunk-based-development': SiGit,
};

import type { Technology } from '../types/skills'; // Import the Technology type

export type Props = {
  title: string;
  description: string;
  iconName: string;
  technologies?: Array<Technology>;
};

const { title, description, iconName, technologies = [] } = Astro.props;
const IconComponent = iconComponents[iconName];
---

<Card
  className="flex flex-col h-full hover:shadow-lg transition-shadow duration-300 gap-3 pt-2"
>
  <CardHeader className="pb-3 pt-4">
    {/* Adjusted padding for consistency */}
    {/* User's modified header structure - ensure it's correctly aligned */}
    {/* CardTitle itself is not a flex container, the div inside it is. */}
    <div class="flex items-start">
      {/* This div will be the flex container for icon and title text block */}
      <div class="mr-4 flex-shrink-0">
        {/* Icon container */}
        <span
          class="inline-flex items-center justify-center p-2 bg-primary/10 rounded-lg"
        >
          <IconComponent className="size-5 text-primary" />
        </span>
      </div>
      <div class="flex-grow">
        {/* Title block, allows title to wrap */}
        <CardTitle
          className="text-lg font-semibold group-hover:text-primary transition-colors"
        >
          {title}
        </CardTitle>
      </div>
    </div>
  </CardHeader>

  <CardContent className="flex-grow pt-2 pb-3">
    {/* flex-grow pushes footer down, padding adjusted */}
    {
      /* Description text indented to align with title. Calculation: icon div's mr-4 (1rem) + icon span's effective width (approx 2.25rem) = 3.25rem */
    }
    <p class="text-sm text-muted-foreground line-clamp-3 pl-[3.25rem]">
      {description}
    </p>
  </CardContent>

  {
    technologies && technologies.length > 0 && (
      <CardFooter className="pt-3 pb-4 flex flex-wrap gap-x-3 gap-y-2 justify-start items-center">
        {technologies.map((tech) => {
          const TechIcon = techIconComponents[tech.id.toLowerCase()];
          if (!TechIcon) return null;
          
          // Special handling for Devicon components which use a different prop for className
          const isDevicon = typeof TechIcon === 'function' && 
                          (TechIcon.displayName?.includes('Original') || 
                           TechIcon.displayName?.includes('Plain') ||
                           TechIcon.displayName?.includes('Line'));
          
          return isDevicon ? (
            <div class="w-5 h-5 flex items-center justify-center" title={tech.name}>
              <TechIcon className="w-full h-full" />
            </div>
          ) : (
            <TechIcon
              className="size-5 text-muted-foreground hover:text-primary transition-colors"
              title={tech.name}
            />
          );
        })}
      </CardFooter>
    )
  }
</Card>
